import streamlit as st
import pandas as pd
import io

# ---------------------------------------------------------
# 1. CARGA DE DATOS (Base de datos extra铆da de la imagen)
# ---------------------------------------------------------

def load_data():
    # Definimos los datos crudos para cada peso
    
    # Tabla 13300 LBS
    csv_13300 = """TEMP;TW_10_V1;TW_10_DIST;HW_0_V1;HW_0_DIST;HW_10_V1;HW_10_DIST;HW_20_V1;HW_20_DIST;HW_30_V1;HW_30_DIST;VR;V2
-25;106;3320;105;2530;104;2300;103;2090;103;1900;106;114
-20;106;3370;105;2570;104;2350;103;2130;103;1930;106;114
-15;106;3420;105;2620;104;2390;103;2180;103;1970;106;114
-10;106;3470;105;2660;104;2430;103;2220;103;2010;106;114
-5;106;3520;104;2710;104;2480;103;2260;103;2050;106;114
0;106;3570;104;2750;104;2520;103;2300;103;2090;106;114
5;106;3640;104;2810;104;2570;103;2350;103;2140;106;114
10;106;3750;105;2900;104;2660;103;2430;103;2210;106;114
15;106;3900;105;2990;104;2740;104;2500;103;2280;106;114
20;105;4230;106;3210;106;2930;105;2680;104;2430;106;114
25;105;4640;106;3500;106;3170;106;2870;105;2610;106;114
30;105;5220;106;3850;106;3480;106;3120;106;2810;106;114
35;104;5920;106;4280;106;3860;106;3460;106;3090;106;114
40;103;6760;107;4750;107;4280;107;3830;107;3410;107;114
45;102;7800;107;5280;107;4750;107;4250;107;3770;107;114
50;102;8900;107;5940;107;5330;107;4760;107;4220;107;114
54;101;9830;107;6450;107;5780;107;5150;107;4550;107;114"""

    # Tabla 13000 LBS
    csv_13000 = """TEMP;TW_10_V1;TW_10_DIST;HW_0_V1;HW_0_DIST;HW_10_V1;HW_10_DIST;HW_20_V1;HW_20_DIST;HW_30_V1;HW_30_DIST;VR;V2
-25;105;3160;103;2420;102;2200;102;2000;101;1810;105;113
-20;105;3210;103;2460;102;2250;102;2040;101;1850;105;113
-15;105;3260;103;2510;102;2290;102;2080;101;1890;105;113
-10;105;3300;103;2550;102;2330;102;2120;101;1920;105;113
-5;105;3350;103;2590;102;2370;102;2160;101;1960;105;113
0;105;3400;103;2640;102;2410;101;2200;101;2000;105;113
5;105;3460;103;2690;102;2460;102;2250;101;2040;105;113
10;105;3580;103;2770;102;2540;102;2320;101;2110;105;113
15;105;3700;103;2860;103;2620;102;2390;102;2180;105;113
20;105;4020;105;3080;104;2800;103;2550;102;2320;105;113
25;105;4390;105;3320;105;3000;104;2740;103;2490;105;113
30;105;4830;105;3650;105;3290;105;2950;105;2680;105;113
35;105;5380;105;4040;105;3640;105;3270;105;2910;105;113
40;105;6020;105;4470;105;4030;105;3610;105;3210;105;113
45;104;6830;105;4950;105;4460;105;3990;105;3540;105;113
50;103;7830;105;5560;105;4980;105;4460;105;3950;105;113
54;102;9030;106;6240;106;5590;106;4980;106;4400;106;113"""

    # Tabla 12500 LBS
    csv_12500 = """TEMP;TW_10_V1;TW_10_DIST;HW_0_V1;HW_0_DIST;HW_10_V1;HW_10_DIST;HW_20_V1;HW_20_DIST;HW_30_V1;HW_30_DIST;VR;V2
-25;102;2920;100;2250;99;2050;99;1860;98;1670;102;111
-20;102;2970;100;2290;99;2090;99;1890;98;1710;102;111
-15;102;3010;100;2330;99;2130;99;1930;98;1740;102;111
-10;102;3060;100;2370;99;2160;99;1960;98;1780;102;111
-5;102;3100;100;2410;99;2200;99;2000;98;1810;102;111
0;102;3150;100;2450;99;2240;99;2040;98;1850;102;111
5;102;3200;100;2500;99;2290;99;2080;98;1890;102;111
10;102;3300;100;2570;100;2360;99;2150;98;1950;102;111
15;103;3400;100;2650;100;2430;99;2210;99;2010;103;111
20;103;3690;102;2830;101;2590;100;2360;100;2150;103;111
25;103;4010;103;3030;102;2770;101;2530;101;2300;103;111
30;103;4400;103;3320;103;3000;103;2710;102;2470;103;111
35;103;4870;103;3670;103;3310;103;2960;103;2660;103;111
40;103;5380;103;4040;103;3640;103;3260;103;2900;103;111
45;103;5950;103;4460;103;4010;103;3590;103;3190;103;111
50;103;6650;103;4970;103;4460;103;3980;103;3540;103;111
54;103;7440;103;5530;103;4960;103;4420;103;3920;103;111"""

    # Tabla 12000 LBS
    csv_12000 = """TEMP;TW_10_V1;TW_10_DIST;HW_0_V1;HW_0_DIST;HW_10_V1;HW_10_DIST;HW_20_V1;HW_20_DIST;HW_30_V1;HW_30_DIST;VR;V2
-25;99;2710;97;2080;96;1890;96;1710;95;1540;100;109
-20;99;2750;97;2120;96;1930;96;1750;95;1570;100;109
-15;98;2800;97;2160;96;1960;96;1780;95;1610;100;109
-10;99;2840;97;2190;96;2000;96;1810;95;1640;100;109
-5;99;2880;97;2230;96;2030;96;1850;95;1670;100;109
0;98;2920;97;2270;96;2070;96;1880;95;1700;100;109
5;99;2970;97;2310;96;2110;96;1920;95;1740;100;109
10;99;3060;97;2390;97;2180;96;1980;95;1800;100;109
15;99;3150;97;2460;97;2240;96;2050;96;1850;100;109
20;100;3370;99;2620;98;2390;97;2180;97;1980;100;109
25;101;3660;100;2790;99;2550;98;2330;98;2120;101;109
30;101;4010;101;3020;100;2740;100;2500;99;2270;101;109
35;101;4420;101;3320;101;3000;101;2690;100;2440;101;109
40;101;4870;101;3650;101;3290;101;2940;101;2620;101;109
45;101;5350;101;4010;101;3610;101;3230;101;2870;101;109
50;101;5940;101;4440;101;3990;101;3570;101;3170;101;109
54;101;6600;101;4920;101;4410;101;3940;101;3490;101;109"""

    # Convertir CSV strings a DataFrames
    df_13300 = pd.read_csv(io.StringIO(csv_13300), sep=";")
    df_13000 = pd.read_csv(io.StringIO(csv_13000), sep=";")
    df_12500 = pd.read_csv(io.StringIO(csv_12500), sep=";")
    df_12000 = pd.read_csv(io.StringIO(csv_12000), sep=";")

    return {
        13300: df_13300,
        13000: df_13000,
        12500: df_12500,
        12000: df_12000
    }

# ---------------------------------------------------------
# 2. INTERFAZ DE USUARIO Y LGICA
# ---------------------------------------------------------

st.set_page_config(page_title="Calculadora Despegue", layout="centered")

st.title(" Calculadora de Rendimiento de Despegue")
st.markdown("""
Esta aplicaci贸n calcula las velocidades V1, VR, V2 y la distancia requerida de despegue
basada en las tablas de rendimiento (Flaps 15掳, SL, Anti-Ice OFF).
""")

# Cargar datos
data = load_data()

# --- BARRA LATERAL (INPUTS) ---
st.sidebar.header("Par谩metros de Entrada")

# Selecci贸n de Peso
weights = sorted(list(data.keys()), reverse=True)
selected_weight = st.sidebar.selectbox("Peso de la Aeronave (LBS)", weights, index=1)

# Selecci贸n de Temperatura
# Obtenemos las temperaturas disponibles del dataframe seleccionado
temps = data[selected_weight]['TEMP'].tolist()
selected_temp = st.sidebar.select_slider("Temperatura Exterior (掳C)", options=temps, value=20)

st.sidebar.markdown("---")
st.sidebar.info("Nota: Los datos provienen de la tabla digitalizada. No usar para vuelo real sin verificar con el POH oficial.")

# --- LGICA DE BSQUEDA ---
df = data[selected_weight]
# Filtrar por temperatura exacta
row = df[df['TEMP'] == selected_temp].iloc[0]

# --- RESULTADOS PRINCIPALES ---

st.header(f"Resultados para {selected_weight} LBS @ {selected_temp}掳C")

col1, col2, col3 = st.columns(3)

with col1:
    st.metric(label="VR (Rotaci贸n)", value=f"{row['VR']} KIAS")

with col2:
    st.metric(label="V2 (Seguridad)", value=f"{row['V2']} KIAS")

with col3:
    if selected_weight == 13300:
        venr = 152
    elif selected_weight == 13000:
        venr = 151
    elif selected_weight == 12500:
        venr = 148
    else:
        venr = 145
    st.metric(label="VENR (Ascenso)", value=f"{venr} KIAS")

st.markdown("---")

# --- TABLA DE DISTANCIAS Y V1 ---
st.subheader("Distancias de Despegue y V1 por Viento")

# Crear un dataframe limpio para mostrar
results_data = {
    "Condici贸n de Viento": [
        "Viento de Cola (10 kts)", 
        "Viento Calma (0 kts)", 
        "Viento de Frente (10 kts)", 
        "Viento de Frente (20 kts)", 
        "Viento de Frente (30 kts)"
    ],
    "V1 (KIAS)": [
        row['TW_10_V1'], 
        row['HW_0_V1'], 
        row['HW_10_V1'], 
        row['HW_20_V1'], 
        row['HW_30_V1']
    ],
    "Distancia (Pies)": [
        row['TW_10_DIST'], 
        row['HW_0_DIST'], 
        row['HW_10_DIST'], 
        row['HW_20_DIST'], 
        row['HW_30_DIST']
    ]
}

df_results = pd.DataFrame(results_data)

# Mostrar tabla con estilo
st.table(df_results)